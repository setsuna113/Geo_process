2025-07-23 09:37:11,663 - __main__ - INFO - üìù Logging to: logs/richness_analysis_20250723_093711.log
2025-07-23 09:37:11,663 - __main__ - INFO - üöÄ Starting ENHANCED richness dataset processing pipeline
2025-07-23 09:37:11,663 - __main__ - INFO - üîß Features: Progress tracking, Checkpoints, Memory monitoring, Error recovery
2025-07-23 09:37:11,663 - __main__ - INFO - üíæ Memory limit: 8.0 GB
2025-07-23 09:37:11,664 - __main__ - INFO - üìä Max samples: 500,000
2025-07-23 09:37:11,664 - __main__ - INFO - üéØ Sampling strategy: stratified
2025-07-23 09:37:11,670 - src.database.connection - INFO - ‚úÖ Database connection pool created (attempt 1)
2025-07-23 09:37:11,670 - src.database.connection - INFO -    Host: localhost:5432
2025-07-23 09:37:11,670 - src.database.connection - INFO -    Database: geoprocess_db
2025-07-23 09:37:11,670 - src.database.connection - INFO -    User: jason
2025-07-23 09:37:11,673 - src.database.connection - INFO - ‚úÖ PostgreSQL: PostgreSQL 14.18 (Ubuntu 14.18-0ubuntu0.22.04.1) on x86_64-pc-linux-gnu
2025-07-23 09:37:11,673 - src.database.connection - INFO - ‚úÖ PostGIS: 3.2 USE_GEOS=1 USE_PROJ=1 USE_STATS=1
2025-07-23 09:37:11,674 - __main__ - INFO - Checking database setup...
2025-07-23 09:37:11,674 - src.database.connection - INFO - ‚úÖ PostgreSQL: PostgreSQL 14.18 (Ubuntu 14.18-0ubuntu0.22.04.1) on x86_64-pc-linux-gnu
2025-07-23 09:37:11,674 - src.database.connection - INFO - ‚úÖ PostGIS: 3.2 USE_GEOS=1 USE_PROJ=1 USE_STATS=1
2025-07-23 09:37:11,675 - __main__ - INFO - üì• STAGE 1: Loading datasets into catalog...
2025-07-23 09:37:11,675 - __main__ - INFO - ‚úÖ Found datasets:
  - Plants: data/richness_maps/daru-plants-richness.tif
  - Terrestrial: data/richness_maps/iucn-terrestrial-richness.tif
2025-07-23 09:37:11,718 - src.raster.loaders.geotiff_loader - INFO - Loaded metadata for daru-plants-richness.tif:
2025-07-23 09:37:11,719 - src.raster.loaders.geotiff_loader - INFO -   Size: 21600 x 10410
2025-07-23 09:37:11,719 - src.raster.loaders.geotiff_loader - INFO -   Resolution: 0.016667¬∞
2025-07-23 09:37:11,719 - src.raster.loaders.geotiff_loader - INFO -   Data type: Int32
2025-07-23 09:37:11,719 - src.raster.loaders.geotiff_loader - INFO -   NoData: 0.0
2025-07-23 09:37:11,846 - __main__ - INFO - ‚úÖ Added plants dataset: daru-plants-richness
2025-07-23 09:37:11,871 - src.raster.loaders.geotiff_loader - INFO - Loaded metadata for iucn-terrestrial-richness.tif:
2025-07-23 09:37:11,871 - src.raster.loaders.geotiff_loader - INFO -   Size: 21600 x 8280
2025-07-23 09:37:11,871 - src.raster.loaders.geotiff_loader - INFO -   Resolution: 0.016667¬∞
2025-07-23 09:37:11,871 - src.raster.loaders.geotiff_loader - INFO -   Data type: UInt16
2025-07-23 09:37:11,871 - src.raster.loaders.geotiff_loader - INFO -   NoData: 0.0
2025-07-23 09:37:11,999 - __main__ - INFO - ‚úÖ Added terrestrial dataset: iucn-terrestrial-richness
2025-07-23 09:37:12,000 - __main__ - INFO - ‚úÖ Checkpoint saved: catalog_loaded
2025-07-23 09:37:12,000 - __main__ - INFO - üîó STAGE 2: Merging datasets with robust alignment...
2025-07-23 09:37:12,001 - src.base.memory_tracker - INFO - Memory monitoring started
2025-07-23 09:37:12,001 - __main__ - INFO - üìä Dataset size: 224,856,000 pixels
2025-07-23 09:37:12,001 - __main__ - INFO - ‚è±Ô∏è  Estimated merge time: ~3m
2025-07-23 09:37:12,002 - src.processors.data_preparation.raster_merger - INFO - Merging 2 rasters
2025-07-23 09:37:12,010 - src.processors.data_preparation.raster_alignment - INFO - Analyzing alignment with reference: daru-plants-richness.tif
2025-07-23 09:37:12,012 - src.processors.data_preparation.raster_merger - INFO - Found 1 alignment issues, attempting fixes...
2025-07-23 09:37:12,012 - src.processors.data_preparation.raster_alignment - INFO - Analyzing alignment with reference: daru-plants-richness.tif
2025-07-23 09:37:12,170 - src.processors.data_preparation.raster_alignment - INFO - Aligned daru-plants-richness.tif -> aligned_daru-plants-richness.tif
2025-07-23 09:37:14,583 - src.processors.data_preparation.raster_alignment - INFO - Aligned iucn-terrestrial-richness.tif -> aligned_iucn-terrestrial-richness.tif
2025-07-23 09:37:14,583 - src.processors.data_preparation.raster_alignment - INFO - Analyzing alignment with reference: aligned_daru-plants-richness.tif
2025-07-23 09:37:14,584 - src.processors.data_preparation.raster_alignment - WARNING - Output rasters still have alignment issues!
2025-07-23 09:37:14,584 - src.processors.data_preparation.raster_alignment - WARNING - Remaining issues: 1
2025-07-23 09:37:14,585 - src.processors.data_preparation.raster_merger - INFO - ‚úÖ Successfully aligned rasters for merging
2025-07-23 09:37:14,585 - src.processors.data_preparation.raster_merger - INFO - Loading plants_richness from /tmp/tmpu8795hyq/aligned_daru-plants-richness.tif
2025-07-23 09:37:14,594 - src.processors.data_preparation.raster_merger - INFO - Loading terrestrial_richness from /tmp/tmpu8795hyq/aligned_iucn-terrestrial-richness.tif
2025-07-23 09:37:14,598 - src.processors.data_preparation.raster_merger - WARNING - Aligning terrestrial_richness to reference coordinates
2025-07-23 09:37:15,085 - src.processors.data_preparation.raster_merger - INFO - üßπ Cleaned up temporary alignment files
2025-07-23 09:37:15,085 - __main__ - INFO - ‚úÖ Merged data shape: {'lon': 21600, 'lat': 10410}
2025-07-23 09:37:15,085 - __main__ - INFO -    Bands: ['plants_richness', 'terrestrial_richness']
2025-07-23 09:37:15,085 - __main__ - INFO - ‚úÖ Checkpoint saved: datasets_merged
2025-07-23 09:37:15,086 - __main__ - INFO - üß† STAGE 3: Running SOM analysis...
2025-07-23 09:37:15,086 - __main__ - INFO - üìä SOM Analysis details:
2025-07-23 09:37:15,086 - __main__ - INFO -    Grid: [8, 8] (64 neurons)
2025-07-23 09:37:15,086 - __main__ - INFO -    Samples: 224,856,000
2025-07-23 09:37:15,086 - __main__ - INFO -    Features: 2
2025-07-23 09:37:15,087 - __main__ - INFO -    Iterations: 1000
2025-07-23 09:37:15,087 - __main__ - INFO - ‚è±Ô∏è  Estimated SOM time: ~3m
2025-07-23 09:37:15,087 - __main__ - INFO - SOM parameters: {'grid_size': [8, 8], 'iterations': 1000, 'sigma': 1.5, 'learning_rate': 0.5, 'neighborhood_function': 'gaussian', 'random_seed': 42}
2025-07-23 09:37:15,087 - src.spatial_analysis.som.som_trainer - INFO - Starting SOM analysis
2025-07-23 09:37:15,132 - src.spatial_analysis.base_analyzer - INFO - Progress: 20.0% - Preparing data
2025-07-23 09:37:15,132 - src.processors.spatial_analysis.data_processor - INFO - Preparing data with memory-aware processing: True
2025-07-23 09:37:15,133 - src.processors.spatial_analysis.data_processor - INFO - Data size: 1.68 GB, Available: 11.75 GB
2025-07-23 09:37:15,133 - src.processors.spatial_analysis.data_processor - INFO - Normalizing data
2025-07-23 09:37:33,424 - src.processors.spatial_analysis.data_processor - INFO - Prepared data shape: (224856000, 2)
2025-07-23 09:37:33,424 - src.spatial_analysis.som.som_trainer - INFO - Training SOM on 224856000 samples with 2 features
2025-07-23 09:37:33,425 - src.spatial_analysis.base_analyzer - INFO - Progress: 40.0% - Initializing SOM
2025-07-23 09:37:33,425 - src.spatial_analysis.base_analyzer - INFO - Progress: 60.0% - Training SOM
2025-07-23 09:37:33,425 - src.spatial_analysis.som.som_trainer - INFO - Data size: 3.35 GB, SOM overhead: 10.05 GB, Available: 5.61 GB
2025-07-23 09:37:33,425 - src.spatial_analysis.som.som_trainer - WARNING - Dataset too large (224,856,000 samples), using subsampling
2025-07-23 09:37:33,426 - src.spatial_analysis.som.som_trainer - INFO - Generating synthetic spatial coordinates for stratified sampling
2025-07-23 09:37:35,460 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:35,460 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:35,461 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:36,461 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:36,461 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:36,461 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:37,462 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:37,462 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:37,462 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:38,463 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:38,463 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:38,463 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:39,464 - src.base.processor - WARNING - Memory pressure detected (critical)
2025-07-23 09:37:39,920 - src.base.memory_tracker - INFO - Garbage collection freed -127.22 MB
2025-07-23 09:37:39,920 - src.base.processor - WARNING - Memory pressure detected (critical)
2025-07-23 09:37:40,227 - src.base.memory_tracker - INFO - Garbage collection freed -134.18 MB
2025-07-23 09:37:40,228 - src.base.processor - WARNING - Memory pressure detected (critical)
2025-07-23 09:37:40,556 - src.base.memory_tracker - INFO - Garbage collection freed -69.32 MB
2025-07-23 09:37:41,557 - src.base.processor - WARNING - Memory pressure detected (critical)
2025-07-23 09:37:41,915 - src.base.memory_tracker - INFO - Garbage collection freed 11.00 MB
2025-07-23 09:37:41,915 - src.base.processor - WARNING - Memory pressure detected (critical)
2025-07-23 09:37:42,293 - src.base.memory_tracker - INFO - Garbage collection freed 26.75 MB
2025-07-23 09:37:42,293 - src.base.processor - WARNING - Memory pressure detected (critical)
2025-07-23 09:37:42,676 - src.base.memory_tracker - INFO - Garbage collection freed 78.50 MB
2025-07-23 09:37:43,680 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:43,684 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:43,684 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:44,685 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:44,687 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:44,687 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:45,688 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:45,688 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:45,688 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:45,770 - src.spatial_analysis.memory_aware_processor - INFO - Subsampling 224,856,000 samples to 500,000
2025-07-23 09:37:46,688 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:46,688 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:46,688 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:47,689 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:47,689 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:47,689 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:48,690 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:48,690 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:48,690 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:49,690 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:49,690 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:49,690 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:50,691 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:50,691 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:50,691 - src.base.processor - WARNING - Memory pressure detected (high)
2025-07-23 09:37:51,692 - src.base.processor - WARNING - Memory pressure detected (critical)
